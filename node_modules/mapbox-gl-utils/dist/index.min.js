!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).U=e()}(this,(function(){"use strict";var t={paints:"fill-antialias,fill-opacity,fill-color,fill-outline-color,fill-translate,fill-translate-anchor,fill-pattern,fill-extrusion-opacity,fill-extrusion-color,fill-extrusion-translate,fill-extrusion-translate-anchor,fill-extrusion-pattern,fill-extrusion-height,fill-extrusion-base,fill-extrusion-vertical-gradient,line-opacity,line-color,line-translate,line-translate-anchor,line-width,line-gap-width,line-offset,line-blur,line-dasharray,line-pattern,line-gradient,circle-radius,circle-color,circle-blur,circle-opacity,circle-translate,circle-translate-anchor,circle-pitch-scale,circle-pitch-alignment,circle-stroke-width,circle-stroke-color,circle-stroke-opacity,heatmap-radius,heatmap-weight,heatmap-intensity,heatmap-color,heatmap-opacity,icon-opacity,icon-color,icon-halo-color,icon-halo-width,icon-halo-blur,icon-translate,icon-translate-anchor,text-opacity,text-color,text-halo-color,text-halo-width,text-halo-blur,text-translate,text-translate-anchor,raster-opacity,raster-hue-rotate,raster-brightness-min,raster-brightness-max,raster-saturation,raster-contrast,raster-resampling,raster-fade-duration,hillshade-illumination-direction,hillshade-illumination-anchor,hillshade-exaggeration,hillshade-shadow-color,hillshade-highlight-color,hillshade-accent-color,background-color,background-pattern,background-opacity".split(","),layouts:"visibility,fill-sort-key,circle-sort-key,line-cap,line-join,line-miter-limit,line-round-limit,line-sort-key,symbol-placement,symbol-spacing,symbol-avoid-edges,symbol-sort-key,symbol-z-order,icon-allow-overlap,icon-ignore-placement,icon-optional,icon-rotation-alignment,icon-size,icon-text-fit,icon-text-fit-padding,icon-image,icon-rotate,icon-padding,icon-keep-upright,icon-offset,icon-anchor,icon-pitch-alignment,text-pitch-alignment,text-rotation-alignment,text-field,text-font,text-size,text-max-width,text-line-height,text-letter-spacing,text-justify,text-radial-offset,text-variable-anchor,text-anchor,text-max-angle,text-writing-mode,text-rotate,text-padding,text-keep-upright,text-transform,text-offset,text-allow-overlap,text-ignore-placement,text-optional".split(",")};const e=t=>t.replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`)),o=t=>t.replace(/(^|-)([a-z])/g,((t,e,o)=>`${o.toUpperCase()}`));function r(t){return String(t).match(/\.(geo)?json/)||"Feature"===t.type||"FeatureCollection"===t.type?{type:"geojson",data:t}:String(t).match(/^mapbox:\/\//)?{type:"vector",url:t}:t}const i=(t,e)=>Array.isArray(t)?t:t instanceof RegExp?e.getStyle().layers.map((t=>t.id)).filter((e=>e.match(t))):t instanceof Function?e.getStyle().layers.filter((e=>t(e))).map((t=>t.id)):[t],a=t=>function(e,...o){return i(e,this.map).map((e=>t.call(this,e,...o)))},s=t=>function(e,...o){const r=i(e,this.map).map((e=>t.call(this,e,...o)));return()=>r.forEach((t=>t()))},n=["line","fill","circle","symbol","video","raster","fill-extrusion","heatmap","hillshade"];class l{constructor(){this._loaded=!1}static init(t,e){return t.U=new l,t.U.mapboxgl=e,t.U.map=t,t.U}static async newMap(t,e={},o={}){if(e.style||(e.style={version:8,layers:[],sources:{}}),o.addLayers||o.addSources||o.transformStyle||o.mixStyles){let t,r=e.style;if("string"==typeof r){const e=r.replace(/^mapbox:\/\/styles\//,"https://api.mapbox.com/styles/v1/"),o=await fetch(e);t=await o.json()}else t=r;const i=new l;(function(t,e=[]){t.layers=[...t.layers,...e.map((t=>this.layerStyle(t)))]}).call(i,t,o.addLayers),function(t,e={}){t.sources={...t.sources,...e}}(t,o.addSources),function(t,e=(t=>t)){t=e(t)}(t,o.transformStyle),function(t,e={}){Object.keys(e).forEach((o=>{const r=e[o].layers;delete e[o].layers,t.sources[o]=e[o],t.layers=[...t.layers,...r.map((t=>this.layerStyle({source:o,...t})))]}))}.call(i,t,o.mixStyles),e.style=t}const r=new t.Map(e);return l.init(r,t),r}}Object.assign(l.prototype,{hoverPointer:(()=>function(t){const e=i(t,this.map),o=t=>this.map.getCanvas().style.cursor="pointer",r=t=>{0===this.map.queryRenderedFeatures(t.point,{layers:e}).length&&(this.map.getCanvas().style.cursor=a)},a=this.map.getCanvas().style.cursor;for(const t of e)this.map.on("mouseleave",t,r),this.map.on("mouseenter",t,o);return()=>{for(const t of e)this.map.off("mouseenter",t,o),this.map.off("mouseleave",t,r);this.map.getCanvas().style.cursor=a}}).call(void 0),hoverFeatureState:s((function(t,e,o,r,i){if(Array.isArray(e)){let o=e.map((([e,o])=>this.hoverFeatureState(t,e,o)));return()=>o.forEach((t=>t()))}if(void 0===e){const r=this.getLayerStyle(t);e=r.source,o=r["source-layer"]}let a;function s(t){a&&this.map.setFeatureState({source:e,sourceLayer:o,id:a},{hover:t})}const n=t=>{const e=t.features[0];e&&e.id===a||(s(!1),e&&(a&&i&&i({...t,oldFeatureId:a}),a=e.id,s(!0),r&&r(t)))},l=t=>{s(!1),t&&t.oldFeatureId&&(t.oldFeatureId=a),a=void 0,i&&i(t)};return this.map.on("mousemove",t,n),this.map.on("mouseleave",t,l),()=>{this.map.off("mousemove",t,n),this.map.off("mouseleave",t,l),l()}})),hoverPopup(t,e,o={}){const r=new this.mapboxgl.Popup({closeButton:!1,...o});return s((function(t,e){function o(t){t.features[0]&&(r.setLngLat(t.lngLat),r.setHTML(e(t.features[0],r)),r.addTo(map))}function i(t){r.remove()}return this.map.on("mouseenter",t,o),this.map.on("mouseout",t,i),()=>{this.map.off("mouseenter",t,o),this.map.off("mouseout",t,i),i()}})).call(this,t,e)},clickPopup(t,e,o={}){const r=new this.mapboxgl.Popup({...o});return s((function(t,e){function o(t){t.features[0]&&(r.setLngLat(t.features[0].geometry.coordinates.slice()),r.setHTML(e(t.features[0],r)),r.addTo(map))}return this.map.on("click",t,o),()=>this.map.off("click",t,o)})).call(this,t,e)},clickLayer:s((function(t,e){const o=o=>{o.features=this.map.queryRenderedFeatures(o.point,{layers:[t]}),e(o)};return this.map.on("click",t,o),()=>this.map.off("click",t,o)})),clickOneLayer(t,e,o){const r=r=>{let i=!1;for(const o of t){const t=this.map.queryRenderedFeatures(r.point,{layers:[o]});if(t[0])try{e({event:r,layer:o,feature:t[0],features:t})}finally{i=!0;break}}!i&&o&&o(r)};return this.map.on("click",r),()=>this.map.off("click",r)},hoverLayer:s((function(t,e){const o=o=>{o.features=this.map.queryRenderedFeatures(o.point,{layers:[t]}),e(o)};return this.map.on("click",t,o),()=>this.map.off("click",t,o)})),mapAddLayerBefore(t,e){e?this.map.addLayer(t,e):this.map.addLayer(t)},addLayer(t,e,o,r,i){return this.mapAddLayerBefore(this.layerStyle(t,e,o,r),i),this.makeSource(e)},add(t,e,o,i,a){return this.mapAddLayerBefore({id:t,source:r(e),type:o,...this.properties(i)},a),this.makeSource(e)},setLayer(t,e,o,r,i){const a=this.layerStyle(t,e,o,r),s=this.map.getStyle(),n=s.layers.findIndex((t=>t.id===a.id)),l=s.layers.findIndex((t=>t.id===i));return n>=0?s.layers.splice(n,1,a):l>=0?s.layers.splice(l,0,a):s.layers.push(a),this.map.setStyle(s),this.makeSource(e)},removeLayer:a((function(t){const e=t=>{t.error.message.match(/does not exist/)||console.error(t.error)};this.map.once("error",e),this.map.removeLayer(t),this.map.off("error",e)})),addGeoJSON(t,e={type:"FeatureCollection",features:[]},o){return this.addSource(t,{type:"geojson",data:e,...o})},addSource(t,e){const o=this.map.getStyle();return o.sources[t]=e,this.map.setStyle(o),this.makeSource(t)},layersBySource(t){return this.map.getStyle().layers.filter((e=>e.source===t)).map((t=>t.id))},addVector(t,e,o={}){return"string"==typeof e?e.match(/\{z\}/)?this.addSource(t,{type:"vector",tiles:[e],...o}):this.addSource(t,{type:"vector",url:e,...o}):this.addSource(t,{type:"vector",...this.properties(e)})},setProperty:a((function(o,r,i){if("object"==typeof r)Object.keys(r).forEach((t=>this.setProperty(o,t,r[t])));else{const a=e(r);!function(e){return t.paints.indexOf(e)>=0}(a)?function(e){return t.layouts.indexOf(e)>=0}(a)&&this.map.setLayoutProperty(o,a,i):this.map.setPaintProperty(o,a,i)}})),properties(o){if(!o)return;const r={},i={paint:{},layout:{},other:{}};return Object.keys(o).forEach((r=>{const a=e(r);i[function(e){return t.paints.indexOf(e)>=0?"paint":t.layouts.indexOf(e)>=0?"layout":"other"}(a)][a]=o[r]})),Object.keys(i.paint).length&&(r.paint=i.paint),Object.keys(i.layout).length&&(r.layout=i.layout),Object.assign(r,i.other),r},layerStyle(...t){const[e,o,r]=t,i=t.find((t=>"object"==typeof t&&!Array.isArray(t))),a=this.properties(i)||{};return"string"==typeof e&&(a.id=e),"string"==typeof o&&(a.source=o),"string"==typeof r&&(a.type=r),a},getLayerStyle(t){return this.map.getStyle().layers.find((e=>e.id===t))},setLayerStyle:a((function(t,e){const o=(e={},o={})=>Object.keys(e).forEach((e=>{e in o||this.setProperty(t,e,void 0)}));e||(t=(e=t).id);const r=this.getLayerStyle(t),i=this.properties(e);o(r.paint,i.paint),o(r.layout,i.layout),this.setProperty(t,{...i.paint,...i.layout})})),setData(t,e={type:"FeatureCollection",features:[]}){this.map.getSource(t).setData(e)},show:a((function(t){this.setVisibility(t,"visible")})),hide:a((function(t){this.setVisibility(t,"none")})),toggle:a((function(t,e){this.setVisibility(t,e?"visible":"none")})),showSource:a((function(t){this.setVisibility(this.layersBySource(t),"visible")})),hideSource:a((function(t){this.setVisibility(this.layersBySource(t),"none")})),toggleSource:a((function(t,e){this.setVisibility(this.layersBySource(t),e?"visible":"none")})),setFilter:a((function(t,e){this.map.setFilter(t,e)})),removeSource:a((function(t){const e=this.layersBySource(t);this.removeLayer(e),this.map.getSource(t)&&this.map.removeSource(t)})),setLayerSource:a((function(t,e,o){const r=this.map.getStyle().layers,i=r.findIndex((e=>e.id===t)),a=r[i],s=r[i+1]&&r[i+1].id;a.source=e,o?a["source-layer"]=o:void 0!==o&&delete a["source-layer"],this.map.removeLayer(t),this.mapAddLayerBefore(a,s)})),onLoad(t){if(!t)return new Promise((t=>this.onLoad(t)));this.map.loaded()||this._loaded?t():this.map.once("load",(()=>{this._loaded=!0,t()}))},setRootProperty(t,o){const r=this.map.getStyle();r[e(t)]=o,this.map.setStyle(r)},setTransition(t){this.setRootProperty("transition",t)},loadImage(t,e,o){return"string"==typeof e?new Promise(((r,i)=>{this.map.loadImage(e,((a,s)=>{a?(console.error(`Error loading image ${e}`,a),i(`Error loading image ${e}`,a)):(this.map.addImage(t,s,o),r(t,e,s))}))})):this.map.addImage(t,e,o)},lockOrientation(){this.map.touchZoomRotate.disableRotation(),this.map.dragRotate.disable()},fontsInUse(){function t(o){Array.isArray(o)&&("literal"===o[0]?e.push(...o[1]):o.forEach(t))}let e=[];const o=this.map.getStyle().layers.map((t=>t.layout&&t.layout["text-font"])).filter(Boolean);for(const r of o)if(r.stops)try{e.push(...r.stops.flat().filter(Array.isArray).flat())}catch{console.log("Couldn't process font expression:",r)}else r.every((t=>"string"==typeof t))?e.push(...r):t(r);return[...new Set(e)]}});return function(e){const r=(t,r)=>{const i="set"+o(t);e[i]=a((function(e,o){return this.map[r](e,t,o)}))},i=(t,r)=>{const i="get"+o(t);e[i]=a((function(e){return this.map[r](e,t)}))},s=(t,e,r)=>{let i;i=r?function(e,o,i){return this.setLayer(e,r,t,o,i)}:function(e,o,r,i){return this.setLayer(e,o,t,r,i)};const a=o(t);e[`add${a}`]=i,e[`add${a}Layer`]=i};e.makeSource=function(t){const e=new l;return e.map=this.map,e.mapboxgl=this.mapboxgl,n.forEach((function(o){s(o,e,t)})),e},e.update=e.setData,t.paints.forEach((t=>r(t,"setPaintProperty"))),t.layouts.forEach((t=>r(t,"setLayoutProperty"))),t.paints.forEach((t=>i(t,"getPaintProperty"))),t.layouts.forEach((t=>i(t,"getLayoutProperty"))),n.forEach((t=>s(t,e))),["raster","raster-dem","image","video"].forEach((t=>function(t){const r="add"+o(t);e[r]=function(e,o){return this.addSource(e,{type:t,...o})},e[r+"Source"]=e[r]}(t)))}(l.prototype),l}));
